{
  "model_transfer_config": {
    "description": "确保standalone预训练模型与PPO热启动模型之间的兼容性",
    "version": "1.0",
    "compatibility_checks": {
      "state_dim_match": true,
      "action_dim_match": true,
      "hidden_size_compatibility": true,
      "layer_structure_validation": true
    }
  },
  "pretrain_to_ppo_mapping": {
    "shared_components": {
      "feature_extractor": {
        "source": "pretrain.backbone",
        "target": "ppo.actor.backbone",
        "transfer_strategy": "direct_copy",
        "freeze_initial_epochs": 5
      },
      "strategy_embeddings": {
        "source": "pretrain.strategy_embedding",
        "target": "ppo.actor.strategy_embedding",
        "transfer_strategy": "direct_copy",
        "adaptive_fine_tune": true
      },
      "attention_weights": {
        "source": "pretrain.attention_layers",
        "target": "ppo.actor.attention_layers",
        "transfer_strategy": "scaled_copy",
        "scaling_factor": 0.8
      }
    },
    "ppo_specific_components": {
      "critic_network": {
        "initialization": "kaiming_normal",
        "bias_initialization": "zero",
        "layer_scaling": "progressive"
      },
      "value_head": {
        "initialization": "xavier_uniform",
        "bias_initialization": "small_positive",
        "output_scaling": 0.1
      }
    }
  },
  "training_schedule": {
    "phase_1_warmup": {
      "duration_steps": 1000,
      "frozen_components": ["feature_extractor", "strategy_embeddings"],
      "learning_rates": {
        "actor": 1e-5,
        "critic": 1e-4
      },
      "description": "渐进式解冻，先训练PPO特有组件"
    },
    "phase_2_joint_training": {
      "duration_steps": 5000,
      "frozen_components": [],
      "learning_rates": {
        "actor": 3e-4,
        "critic": 5e-4
      },
      "description": "联合训练所有组件，较低学习率保护预训练知识"
    },
    "phase_3_full_optimization": {
      "duration_steps": -1,
      "frozen_components": [],
      "learning_rates": {
        "actor": 3e-4,
        "critic": 3e-4
      },
      "description": "完全优化，标准PPO学习率"
    }
  },
  "state_dimension_compatibility": {
    "pretrain_state_dim": 210,
    "ppo_state_dim": 210,
    "status": "ENHANCED - Perfect match with queue delay features",
    "comment": "Both pretrain and PPO now use 210-dimensional state vectors with enhanced queue delay features",
    "state_formula": "num_replicas * (14+8+28) + 10 = 4 * 50 + 10 = 210 (queue delay in base 14)",
    "new_features": ["oldest_request_wait_time", "avg_queue_wait_time", "queue_urgency_score"],
    "direct_transfer": true,
    "requires_adaptation": false
  },
  "enhanced_architecture_features": {
    "cross_replica_attention": {
      "enable": true,
      "feature_dim": 320,
      "num_heads": 4,
      "dropout": 0.1,
      "use_layer_norm": true,
      "pretrain_compatibility": "FULL_SUPPORT",
      "comment": "Cross-replica attention supported in both pretrain and PPO"
    },
    "temporal_lstm": {
      "enable": true,
      "feature_chunks": 4,
      "bidirectional": true,
      "hidden_size_ratio": 0.25,
      "pretrain_compatibility": "FULL_SUPPORT",
      "comment": "Temporal LSTM for sequence modeling in both pretrain and PPO"
    },
    "enhanced_normalization": {
      "enable_adaptive_scaling": true,
      "use_log_scaling_for_wait_times": true,
      "use_sqrt_scaling_for_averages": true,
      "pretrain_compatibility": "FULL_SUPPORT",
      "comment": "Enhanced state normalization with log/sqrt scaling"
    }
  },
  "architecture_validation": {
    "required_dimensions": {
      "pretrain_state_dim": 210,
      "ppo_state_dim": 210,
      "dimension_compatibility": "PERFECT_MATCH_ENHANCED",
      "action_dim": 4,
      "pretrain_hidden_size": 320,
      "ppo_actor_hidden_size": 320,
      "ppo_critic_hidden_size": 384
    },
    "layer_compatibility": {
      "gru_layers": {
        "pretrain": 3,
        "ppo_actor": 3,
        "ppo_critic": 3,
        "compatibility_status": "MATCHED - Direct weight transfer possible"
      },
      "attention_heads": {
        "pretrain": 4,
        "ppo": 4,
        "head_dimension": 80,
        "cross_replica_attention": "FULLY_COMPATIBLE"
      },
      "temporal_lstm": {
        "pretrain": "enabled",
        "ppo": "enabled",
        "feature_chunks": 4,
        "bidirectional": true,
        "hidden_size_ratio": 0.25,
        "compatibility_status": "MATCHED - Direct architecture transfer"
      },
      "enhanced_features": {
        "state_normalization": "adaptive_scaling",
        "queue_delay_features": "enabled",
        "cross_replica_comparison": "attention_based",
        "temporal_modeling": "bidirectional_lstm"
      }
    }
  },
  "performance_monitoring": {
    "compatibility_metrics": [
      "feature_similarity_before_after_transfer",
      "gradient_norm_stability",
      "policy_entropy_preservation",
      "value_function_initialization_quality"
    ],
    "alert_thresholds": {
      "feature_similarity_min": 0.7,
      "gradient_explosion_max": 10.0,
      "entropy_drop_max": 0.5,
      "value_variance_max": 100.0
    }
  }
}